
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuardianView - Cloud Security Posture Management (CSPM)</title>
    
    <link rel="stylesheet" href="styles.css">
    <script defer src="script.js"></script>
    
    <style>
        /* Custom Styles for a professional, secure look */
        body { background-color: #f0f2f5; }
        .hero { background-color: #007bff; color: white; } /* Blue header for trust */
        .card { box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-radius: 8px; }
        .compliance-bar { height: 20px; border-radius: 4px; overflow: hidden; display: flex; align-items: center; }
        
        /* Custom Text Classes for Severity Colors */
        /* Note: For table text, using Bulma's built-in colors is often cleaner */
        .critical-text { color: white; background-color: #ff3860; font-weight: bold; padding: 0 5px; }
        .high-text { color: #ffdd57; font-weight: bold; }
        .medium-text { color: #3273dc; font-weight: bold; }
        .safe-text { color: white; background-color: #23d160; font-weight: bold; padding: 0 5px; }
        
        /* Dashboard Layout Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Compliance Bar styling for text readability */
        .compliance-bar > div {
            min-width: 50px; 
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            white-space: nowrap;
        }
    </style>
</head>
<body>

    <section class="hero is-small">
        <div class="hero-body">
            <div class="container">
                <h1 class="title is-4 has-text-white">
                    <span class="icon"><i class="fas fa-shield-alt"></i></span>
                    <strong>GuardianView</strong> - Cloud Security Posture Management
                </h1>
                <p class="subtitle is-6 has-text-white">Continuous Posture Assessment for Multi-Cloud Environments</p>
            </div>
        </div>
    </section>

    <div class="container is-max-desktop">

        <section class="section">
            <div id="status-message" class="notification is-info is-light">
                <span class="icon"><i class="fas fa-spinner fa-pulse"></i></span>
                Scanning 3 AWS Accounts and 2 Azure Subscriptions...
            </div>
        </section>

        <div class="dashboard-grid">
            
            <div class="card">
                <div class="card-content">
                    <p class="title is-3" id="total-assets">7,890</p>
                    <p class="subtitle is-6">Total Resources Monitored</p>
                </div>
            </div>

            <div class="card">
                <div class="card-content">
                    <p class="title is-3 has-text-success" id="security-score">92%</p>
                    <p class="subtitle is-6">Security Posture Score (CIS Benchmark)</p>
                </div>
            </div>

            <div class="card">
                <div class="card-content">
                    <p class="title is-3 has-text-danger" id="critical-findings">5</p>
                    <p class="subtitle is-6">Critical Misconfigurations</p>
                </div>
            </div>

            <div class="card">
                <div class="card-content">
                    <p class="title is-3" id="compliance-status">PCI-DSS: 98%</p>
                    <p class="subtitle is-6">Top Compliance Standard</p>
                </div>
            </div>
        </div>

        <section class="section">
            <h3 class="title is-5">Compliance Health (Overall)</h3>
            <div class="compliance-bar" title="92% Compliant">
                <div class="safe-text" style="width: 92%; background-color: #23d160;">92% Compliant</div>
                <div class="critical-text" style="width: 8%; background-color: #ff3860;">8% Non-Compliant</div>
            </div>
        </section>

        <section class="section">
            <h3 class="title is-5">ðŸš¨ Top Security Findings</h3>
            <table class="table is-striped is-hoverable is-fullwidth">
                <thead>
                    <tr>
                        <th>Severity</th>
                        <th>Finding Description</th>
                        <th>Cloud Resource</th>
                        <th>Remediation Guide</th>
                    </tr>
                </thead>
                <tbody id="findings-table-body">
                    </tbody>
            </table>
        </section>

    </div>

    <script>
        // Mock data representing the results of a CSPM scan
        const mockData = [
            { severity: 'Critical', description: 'S3 Bucket is publicly accessible', resource: 'AWS/S3/prod-backup-1', guide: 'Fix S3 Policy', remediationSteps: 'Navigate to S3 console, select bucket, go to Permissions, enable Public Access Block, and clear any public ACLs or policies.' },
            { severity: 'High', description: 'IAM User Key not rotated in 90 days', resource: 'AWS/IAM/service-admin', guide: 'Rotate Access Key', remediationSteps: 'Generate a new access key for the IAM user, update all applications using the old key, and delete the old key after verification.' },
            { severity: 'Medium', description: 'Network Security Group (NSG) allows SSH (Port 22) from 0.0.0.0/0', resource: 'Azure/NSG/web-tier-nsg', guide: 'Restrict Inbound Traffic', remediationSteps: 'Modify the NSG inbound rule for Port 22 to restrict the source IP range to only trusted administrative networks.' },
            { severity: 'Critical', description: 'Database (RDS) not encrypted at rest', resource: 'AWS/RDS/db-app-prod', guide: 'Enable Encryption', remediationSteps: 'Create a snapshot of the database, copy the snapshot with KMS encryption enabled, and restore the database from the encrypted copy.' },
            { severity: 'Low', description: 'Old Load Balancer without HTTP/2 support', resource: 'AWS/ALB/legacy-lb', guide: 'Upgrade ALB', remediationSteps: 'Upgrade the Load Balancer type or configuration to support modern HTTP/2 protocol for better performance and security.' },
            { severity: 'Critical', description: 'S3 Public Access Block is DISABLED', resource: 'AWS/S3/marketing-assets', guide: 'Enable PAB', remediationSteps: 'Go to the S3 bucket permissions and ensure all four Public Access Block settings are checked and saved.' }
        ];

        /**
         * ðŸš¨ NEW FUNCTIONALITY: Shows detailed remediation steps in an alert (or a modal in a real app).
         * @param {string} encodedDetails - JSON string of the finding, URL-encoded.
         */
        function showRemediationDetails(encodedDetails) {
            const finding = JSON.parse(decodeURIComponent(encodedDetails));
            
            // Format the details for the user
            const details = `
--- Remediation Guide ---
Finding: ${finding.description}
Resource: ${finding.resource}
Severity: ${finding.severity}
Guide: ${finding.guide}

Action Required:
${finding.remediationSteps}

(In a real dashboard, this would open a Bulma Modal instead of an alert.)
            `;

            alert(details);
        }

        /**
         * Renders the security findings data into the HTML table.
         * @param {Array<Object>} data - Array of finding objects.
         */
        function renderDashboard(data) {
            const tableBody = document.getElementById('findings-table-body');
            tableBody.innerHTML = ''; // Clear existing content

            let criticalCount = 0;

            data.forEach(item => {
                const row = tableBody.insertRow();
                
                // Determine CSS class for severity
                let severityClass;
                switch(item.severity) {
                    case 'Critical': 
                        severityClass = 'has-text-danger has-text-weight-bold'; 
                        criticalCount++;
                        break;
                    case 'High': 
                        severityClass = 'has-text-warning-dark has-text-weight-bold';
                        break;
                    case 'Medium': 
                        severityClass = 'has-text-info-dark';
                        break;
                    default: 
                        severityClass = 'has-text-grey';
                }

                // Severity Cell
                row.insertCell().innerHTML = `<span class="${severityClass}">${item.severity}</span>`;
                // Description Cell
                row.insertCell().textContent = item.description;
                // Resource Cell
                row.insertCell().textContent = item.resource;
                
                // Remediation Guide Cell - NOW WIRED UP TO THE NEW FUNCTION
                const detailsString = encodeURIComponent(JSON.stringify(item));
                row.insertCell().innerHTML = `<button class="button is-small is-link is-light" onclick="showRemediationDetails('${detailsString}')">
                    ${item.guide}
                </button>`;
            });
            
            // Update KPI data
            document.getElementById('critical-findings').textContent = criticalCount;
        }

        // Run the rendering function when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            renderDashboard(mockData);
            
            // Simulate scan completion
            const statusElement = document.getElementById('status-message');
            statusElement.className = 'notification is-success is-light';
            statusElement.innerHTML = '<span class="icon"><i class="fas fa-check"></i></span> **Scan Complete!** Posture Score: 92%';
        });
    </script>

</body>
</html>
